## Memory layout notes

### memory addressing
On a 64 bit system addresses are 64 bits, that means that 64 bits specified
using 64 bits:
```
                        ffffffffffffffff

 f    f     f    f     f    f     f    f    f    f    f    f    f    f    f    f
1111 1111  1111 1111  1111 1111  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111
 2⁴   2⁴    2⁴   2⁴    2⁴   2⁴    2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   (2⁴)¹⁶ = 1.844674407e+19
 16   16    16   16    16   16    16   16   16   16   16   16   16   16   16   16   16¹⁶   = 1.844674407e+19
```
But only 64 - 16 = 48 bits are used for addressing.
```
                        fffffffffffffff

 f    f     f    f     f    f     f    f    f    f    f    f    f    f    f
1111 1111  1111 1111  1111 1111  1111 1111 1111 1111 1111 1111 1111 1111 1111
 2⁴   2⁴    2⁴   2⁴    2⁴   2⁴    2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   2⁴   (2⁴)¹5 = 1.153921505e+18
 16   16    16   16    16   16    16   16   16   16   16   16   16   16   16   16¹⁵   = 1.153921505e+18
```


### memory layout
Notice that while the memory available in the system is
0xffffffffffffffff
0x7fffffffd160    

```                                                        
 0xffffffffffff     +----------------------------------+                                                 
 0xfffffffffffe     |__________________________________|
 0xfffffffffffd     |__________________________________|
 0xfffffffffffc     |__________________________________|
 0xfffffffffffb     |__________________________________|
 0xfffffffffffa     |__________________________________|
 0xfffffffffff9     |__________________________________|
 0xfffffffffff8     |__________________________________|
 0xfffffffffff7     |__________________________________|
 0xfffffffffff6     |__________________________________|
 0xfffffffffff5     |__________________________________|
 0xfffffffffff4     |__________________________________|
 0xfffffffffff3     |__________________________________|
 0xfffffffffff2     |__________________________________|
 0xfffffffffff1     |__________________________________|
 0xfffffffffff0     |__________________________________|
 0xffffffffffef     |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
 0x000000000012     |__________________________________|
 0x000000000011     |__________________________________|
 0x000000000010     |__________________________________|
 0x00000000000f     |__________________________________|
 0x00000000000e     |__________________________________|
 0x00000000000d     |__________________________________|
 0x00000000000c     |__________________________________|
 0x00000000000b     |__________________________________|
 0x00000000000a     |__________________________________|
 0x000000000009     |__________________________________|
 0x000000000008     |__________________________________|
 0x000000000007     |__________________________________|
 0x000000000006     |__________________________________|
 0x000000000005     |__________________________________|
 0x000000000004     |__________________________________|
 0x000000000003     |__________________________________|
 0x000000000002     |__________________________________|
 0x000000000001     |__________________________________|
 0x000000000000     |__________________________________|

```


The following the stack when entering main in [memory.c](./src/memory.c).
One thing to realise is that when we read memory in lldb we choose how to
see the contents of one or memory addresses. For example:
```console
(lldb) memory read -f x  -c 8 -s 1 $rsp
0x7fffffffd0f0: 0xe8 0xd1 0xff 0xff 0xff 0x7f 0x00 0x00
```
This will show a single memory address and its entire contents. If we specify
one more it will show the next memory address:
```console
(lldb) memory read -f x  -c 9 -s 1 $rsp
0x7fffffffd0f0: 0xe8 0xd1 0xff 0xff 0xff 0x7f 0x00 0x00
0x7fffffffd0f8: 0x00
```
So each memory address contains:
```console
(lldb) memory read -f x -c 1 -s 1 $rsp
0x7fffffffd0f0: 0x00007fffffffd1e8
```
So each memory address can hold ffffffffffffffff (64 bits, 8 bytes).
Now, when you use `memory read` you might see:
```console
(lldb) memory read -f x -c 3 -s 8 $rsp
0x7fffffffd0f0: 0x00007fffffffd1e8 0x0000000100000000
0x7fffffffd100: 0x0000000000401130
```
Which is actually showing the two items on the same line, which looks like they
have the same addess to me. But we can specify how many items to display per
line using `-l`:

```console
(lldb) memory read -f x -c 3 -s 8 $rsp -l 1
0x7fffffffd0f0: 0x00007fffffffd1e8
0x7fffffffd0f8: 0x0000000100000000
0x7fffffffd100: 0x0000000000401130
```
If we look at the addresses we can see hat we are looking at increments of 8.

```                                                        
 0x7fffffffd0f0     +----------------------------------+                                                 
 0xfffffffffffe     |__________________________________|
 0xfffffffffffd     |__________________________________|
 0xfffffffffffc     |__________________________________|
 0xfffffffffffb     |__________________________________|
 0xfffffffffffa     |__________________________________|
 0xfffffffffff9     |__________________________________|
 0xfffffffffff8     |__________________________________|
 0xfffffffffff7     |__________________________________|
 0xfffffffffff6     |__________________________________|
 0xfffffffffff5     |__________________________________|
 0xfffffffffff4     |__________________________________|
 0xfffffffffff3     |__________________________________|
 0xfffffffffff2     |__________________________________|
 0xfffffffffff1     |__________________________________|
 0xfffffffffff0     |__________________________________|
 0xffffffffffef     |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
                    |__________________________________|
 0x000000000012     |__________________________________|
 0x000000000011     |__________________________________|
 0x000000000010     |__________________________________|
 0x00000000000f     |__________________________________|
 0x00000000000e     |__________________________________|
 0x00000000000d     |__________________________________|
 0x00000000000c     |__________________________________|
 0x00000000000b     |__________________________________|
 0x00000000000a     |__________________________________|
 0x000000000009     |__________________________________|
 0x000000000008     |__________________________________|
 0x000000000007     |__________________________________|
 0x000000000006     |__________________________________|
 0x000000000005     |__________________________________|
 0x000000000004     |__________________________________|
 0x000000000003     |__________________________________|
 0x000000000002     |__________________________________|
 0x000000000001     |__________________________________|
 0x000000000000     |__________________________________|
```

```console
(lldb) expr -f b -- 0xffffffffffffffff
(unsigned long) $4 = 0b1111111111111111111111111111111111111111111111111111111111111111

(lldb) expr -f b -- 0x0000000000000000
(int) $5 = 0b00000000000000000000000000000000
```
